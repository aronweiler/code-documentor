# Documentation MCP Server

This MCP (Model Context Protocol) server provides tools to interact with repository documentation generated by the code-documentor tool. It allows AI assistants to find relevant files and understand features based on natural language descriptions.

## Features

- **get_relevant_files**: Find files relevant to a natural language description
- **understand_feature**: Get documentation about specific features or functionality
- Automatically loads and uses the generated `documentation_guide.md`

## Prerequisites

1. **Python Environment Setup**:
   
   **Windows**:
   ```cmd
   # Create virtual environment
   python -m venv venv
   venv\Scripts\activate
   
   # Install dependencies
   pip install -r requirements.txt
   ```
   
   **Linux/macOS**:
   ```bash
   # Create virtual environment
   python3 -m venv venv
   source venv/bin/activate
   
   # Install dependencies
   pip install -r requirements.txt
   ```

2. **Generate documentation for your target repository**:
   ```bash
   python main.py generate --repo-path /path/to/target/repo --guide
   ```

## Starting the MCP Server

### Command Line Usage

#### Option 1: Using Command Line Argument
```bash
# Point to a specific repository
python mcp_server.py /path/to/your/repository

# Example
python mcp_server.py /home/user/projects/my-app
```

#### Option 2: Using Environment Variable
```bash
# Set environment variable
export DOCUMENTATION_REPO_PATH=/path/to/your/repository
python mcp_server.py

# Windows
set DOCUMENTATION_REPO_PATH=C:\path\to\your\repository
python mcp_server.py
```

#### Option 3: Default (Current Directory)
```bash
# Uses current working directory
cd /path/to/your/repository
python mcp_server.py
```

### Testing the Server

You can test the server using the MCP inspector:

```bash
# Install MCP CLI tools if not already installed
pip install "mcp[cli]"

# Test the server
mcp dev mcp_server.py /path/to/your/repository
```

## VS Code Integration

### Method 1: Using VS Code MCP Extension

1. Install the MCP extension for VS Code (if available)
2. Open VS Code settings (Ctrl/Cmd + ,)
3. Search for "MCP" settings
4. Add server configuration:
   ```json
   {
     "mcp.servers": {
       "documentation-server": {
         "command": "python",
         "args": ["/path/to/code-documentor/mcp_server.py", "/path/to/target/repository"],
         "cwd": "/path/to/code-documentor"
       }
     }
   }
   ```

### Method 2: VS Code Tasks

Create a `.vscode/tasks.json` file in your workspace:

```json
{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "Start Documentation MCP Server",
            "type": "shell",
            "command": "python",
            "args": [
                "${workspaceFolder}/path/to/code-documentor/mcp_server.py",
                "${workspaceFolder}"
            ],
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "new"
            },
            "options": {
                "cwd": "${workspaceFolder}/path/to/code-documentor"
            },
            "problemMatcher": []
        }
    ]
}
```

Run the task with Ctrl/Cmd + Shift + P → "Tasks: Run Task" → "Start Documentation MCP Server"

### Method 3: VS Code Launch Configuration

Add to `.vscode/launch.json`:

```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Documentation MCP Server", 
            "type": "python",
            "request": "launch",
            "program": "${workspaceFolder}/path/to/code-documentor/mcp_server.py",
            "args": ["${workspaceFolder}"],
            "console": "integratedTerminal",
            "cwd": "${workspaceFolder}/path/to/code-documentor"
        }
    ]
}
```

## Claude Code Integration

### Method 1: Direct Command Line

When using Claude Code CLI, you can start the MCP server and reference it:

```bash
# Start the MCP server in background
python mcp_server.py /path/to/your/repository &

# Use Claude Code with MCP awareness
claude-code --mcp-server localhost:8080
```

### Method 2: Claude Desktop Integration

Add to your Claude Desktop MCP configuration file:

**macOS**: `~/Library/Application Support/Claude/claude_desktop_config.json`
**Windows**: `%APPDATA%\Claude\claude_desktop_config.json`

**Windows Configuration**:
```json
{
  "mcpServers": {
    "documentation-server": {
      "command": "H:/repos/code-documentor/venv/Scripts/python.exe",
      "args": ["H:/repos/code-documentor/mcp_server.py", "H:/repos/target-repository"],
      "cwd": "H:/repos/code-documentor"
    }
  }
}
```

**macOS/Linux Configuration**:
```json
{
  "mcpServers": {
    "documentation-server": {
      "command": "/path/to/code-documentor/venv/bin/python",
      "args": ["/path/to/code-documentor/mcp_server.py", "/path/to/target/repository"],
      "cwd": "/path/to/code-documentor"
    }
  }
}
```

### Method 3: Environment-based Configuration

Create a startup script `start_mcp_server.sh`:

```bash
#!/bin/bash
export DOCUMENTATION_REPO_PATH="/path/to/your/repository"
cd /path/to/code-documentor
python mcp_server.py
```

Make it executable and reference it in your MCP configuration:

```json
{
  "mcpServers": {
    "documentation-server": {
      "command": "/path/to/start_mcp_server.sh"
    }
  }
}
```

## Available Tools

### get_relevant_files

Find files relevant to a description.

**Input**:
- `description` (string): Natural language description of what you're looking for

**Example**:
```json
{
  "description": "files related to user authentication and login functionality"
}
```

**Output**: List of relevant file paths relative to repository root

### understand_feature

Get documentation about a specific feature.

**Input**:
- `feature_description` (string): Description of the feature to understand

**Example**:
```json
{
  "feature_description": "AI workflow for calculating drive time estimates"
}
```

**Output**: Related documentation content about the feature

## Troubleshooting

### Common Issues

1. **"ModuleNotFoundError: No module named 'mcp'" (Windows)**
   ```cmd
   # Navigate to project directory
   cd H:\repos\code-documentor
   
   # Activate virtual environment
   venv\Scripts\activate
   
   # Install MCP package specifically
   pip install mcp>=1.2.0
   
   # Verify installation
   python -c "import mcp; print('MCP installed successfully')"
   ```

2. **VS Code using wrong Python interpreter**
   - Press `Ctrl+Shift+P` → "Python: Select Interpreter"
   - Choose: `H:\repos\code-documentor\venv\Scripts\python.exe`
   - Restart VS Code if necessary

3. **"Documentation guide not found"**
   - Ensure you've run the documentation generator first
   - Check that `documentation_output/documentation_guide.md` exists in the target repository

4. **"Module not found" errors**
   - Install dependencies: `pip install -r requirements.txt`
   - Ensure you're using the correct Python environment
   - On Windows, make sure virtual environment is activated

5. **Permission errors**
   - Make sure the server has read access to the target repository
   - Check file permissions on the documentation files

6. **Windows Path Issues**
   - Use forward slashes or double backslashes in paths
   - Example: `"H:/repos/code-documentor/mcp_server.py"` or `"H:\\repos\\code-documentor\\mcp_server.py"`

### Debug Mode

Run with debug output:

```bash
# Enable debug logging
export MCP_DEBUG=1
python mcp_server.py /path/to/repository
```

### Testing Tools

Test individual tools:

```bash
# Using MCP inspector
mcp dev mcp_server.py /path/to/repository

# Then in the inspector interface:
# - Call get_relevant_files with {"description": "authentication files"}
# - Call understand_feature with {"feature_description": "user login"}
```

## Repository Structure

The server expects this structure in the target repository:

```
target-repository/
├── documentation_output/
│   ├── documentation_guide.md    # Main guide (required)
│   ├── src/                      # File documentation
│   └── design_documentation/     # Design docs
└── ... (source code files)
```

## Testing the Implementation

### Manual Testing

Test the MCP tools directly:

```bash
# Navigate to project directory
cd H:\repos\code-documentor

# Activate virtual environment
venv\Scripts\activate

# Run the test script
python test_mcp_tools.py
```

### MCP Inspector Testing

Use the MCP inspector to test tools interactively:

```bash
# Start MCP inspector
mcp dev mcp_server.py H:\path\to\target\repository

# Test get_relevant_files
{"description": "files related to user authentication"}

# Test understand_feature  
{"feature_description": "AI workflow for processing documents"}
```

## Implementation Details

### Architecture

The MCP server uses a **LangGraph-based workflow** that integrates with the existing documentation generation infrastructure:

- **MCPManager**: Orchestrates LangGraph workflows for tool operations
- **ConfigManager**: Loads configuration and API keys
- **LLMManager**: Handles multi-provider LLM initialization (OpenAI, Anthropic, Azure)
- **State-based Processing**: Uses `MCPState` model for workflow state management

### LangGraph Workflows

#### get_relevant_files Workflow:
1. **load_documentation**: Loads documentation guide from target repository
2. **analyze_relevance**: Uses LLM to identify relevant SOURCE CODE files
3. **format_results**: Structures results with relevance scores and reasoning

#### understand_feature Workflow:
1. **load_documentation**: Loads documentation guide
2. **analyze_feature**: Extracts feature information using LLM
3. **format_feature_results**: Organizes documentation sections and related files

### Key Features

- **Real LLM Integration**: Uses configured LLM (GPT-4, Claude, etc.) for analysis
- **Source Code Focus**: Specifically identifies CODE files, not documentation files
- **Relevance Scoring**: Provides 0.0-1.0 relevance scores with reasoning
- **Comprehensive Feature Analysis**: Extracts documentation sections, related files, and summaries
- **Error Handling**: Robust error handling with detailed error messages
- **Performance Tracking**: Includes processing time metrics

## Troubleshooting

### Testing Issues

1. **"Documentation guide not found"**
   ```bash
   # Generate documentation first
   python main.py generate --repo-path H:\path\to\target\repo --guide
   ```

2. **LLM API errors**
   - Check your `.env` file has the correct API keys
   - Verify the model name in `config.yaml` is correct
   - Ensure you have API credits/quota available

3. **Import errors in test script**
   ```bash
   # Make sure you're in the right directory and venv is activated
   cd H:\repos\code-documentor
   venv\Scripts\activate
   ```

## Next Steps

1. **Performance Optimization**: Add caching for documentation guide loading
2. **Enhanced Filtering**: Add more sophisticated file type filtering
3. **Batch Processing**: Support for processing multiple queries efficiently  
4. **Additional Tools**: Consider adding tools for:
   - Code dependency analysis
   - Architecture visualization
   - Change impact analysis
   - Test coverage mapping

For more information about the documentation generation process, see the main README.md file.